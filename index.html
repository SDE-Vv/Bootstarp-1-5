<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BS</title>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link id="hljsLightTheme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
    <link id="hljsDarkTheme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark-dimmed.min.css" disabled>
    <style>
        :root {
            --sidebar-width: 240px;
            --sidebar-min-width: 180px;
            --sidebar-max-width: 520px;
            --header-height: 0px;
        }
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: var(--bg-color);
            color: var(--text-color);
            display: grid;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        body::-webkit-scrollbar{
            display: none;
        }
        body.resizing {
            cursor: col-resize;
            user-select: none;
        }
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: var(--header-bg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        header h1 {
            font-size: 1.1rem;
            margin: 0;
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .header-actions button {
            border: 1px solid var(--border-color);
            background: transparent;
            padding: 0.35rem 0.75rem;
            border-radius: 999px;
            color: inherit;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .header-actions button:hover,
        .header-actions button:focus-visible {
            background-color: var(--hover-bg);
        }
        .download-menu {
            position: relative;
        }
        .download-toggle {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            white-space: nowrap;
        }
        .download-options {
            position: absolute;
            top: calc(100% + 0.4rem);
            right: 0;
            display: none;
            flex-direction: column;
            min-width: 180px;
            padding: 0.35rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--nav-bg);
            box-shadow: 0 12px 32px rgba(15, 23, 42, 0.16);
            z-index: 50;
        }
        .download-options.is-open {
            display: flex;
        }
        .download-options button {
            border: none;
            border-radius: 6px;
            background: transparent;
            text-align: left;
            padding: 0.45rem 0.75rem;
            color: inherit;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .download-options button:hover,
        .download-options button:focus-visible {
            background-color: var(--hover-bg);
        }
        main {
            display: grid;
            grid-template-columns: var(--sidebar-width) 6px 1fr;
            min-height: 0;
        }
        nav {
            border-right: 1px solid var(--border-color);
            background-color: var(--nav-bg);
            overflow-y: auto;
            min-width: 0;
            grid-column: 1;
            position: sticky;
            top: var(--header-height);
            align-self: start;
            max-height: calc(100vh - var(--header-height));
            scrollbar-width: none;
        }
        nav::-webkit-scrollbar {
            display: none; 
        }
        .nav-toolbar {
            position: sticky;
            top: 0;
            background-color: var(--nav-bg);
            padding: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            z-index: 1;
        }
        .nav-toolbar input {
            width: 100%;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: inherit;
        }
        .nav-toolbar input::placeholder {
            color: color-mix(in srgb, var(--text-color) 50%, transparent);
        }
        nav ul {
            list-style: none;
            margin: 0;
            padding: 0.5rem;
        }
        nav li {
            margin-bottom: 0.25rem;
        }
        nav button {
            width: 100%;
            text-align: left;
            padding: 0.5rem 0.75rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            color: inherit;
            cursor: pointer;
            font-size: 0.95rem;
        }
        nav button:hover,
        nav button:focus {
            background-color: var(--hover-bg);
        }
        nav button.active {
            background-color: var(--active-bg);
            color: var(--active-text);
        }
        .divider {
            background-color: var(--divider-color);
            cursor: col-resize;
            grid-column: 2;
            position: relative;
            transition: background-color 0.2s ease;
            touch-action: none;
        }
        .divider::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 32px;
            border-radius: 999px;
            background-color: var(--border-color);
        }
        .divider:hover,
        .divider.dragging {
            background-color: var(--hover-bg);
        }
        #content {
            padding: 1.25rem;
            min-width: 0;
            grid-column: 3;
            line-height: 1.6;
            font-size: 1rem;
            max-width: min(960px, 100%);
            margin: 0 auto;
        }
        #pager {
            grid-column: 3;
            padding: 0 1.25rem 1.25rem;
            display: flex;
            justify-content: space-between;
            gap: 0.75rem;
        }
        #pager button {
            flex: 1 1 0;
            border: 1px solid var(--border-color);
            background: var(--nav-bg);
            color: inherit;
            padding: 0.6rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        #pager button:hover:not(:disabled),
        #pager button:focus-visible:not(:disabled) {
            background-color: var(--hover-bg);
        }
        #pager button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        #content h1,
        #content h2,
        #content h3,
        #content h4,
        #content h5,
        #content h6 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.25rem;
            color: var(--heading-color);
            scroll-margin-top: 5rem;
        }
        #content h1 {
            font-size: 2rem;
            margin-top: 0;
            border-bottom-width: 2px;
            position: relative;
        }
        #content h1:first-of-type::after {
            content: "";
            display: block;
            width: 48px;
            height: 4px;
            border-radius: 999px;
            background: linear-gradient(90deg, var(--accent-color), transparent);
            margin-top: 0.5rem;
        }
        #content h2 {
            font-size: 1.5rem;
        }
        #content h3 {
            font-size: 1.25rem;
        }
        #content p {
            margin: 0 0 1rem;
        }
        pre {
            padding: 0.75rem;
            background-color: var(--code-bg);
            border-radius: 6px;
            overflow-x: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 2px rgba(15, 23, 42, 0.12);
        }
        pre code {
            display: block;
        }
        :not(pre) > code {
            background-color: var(--inline-code-bg);
            padding: 0.1rem 0.35rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }
        code {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
        a {
            color: var(--link-color);
            text-decoration: underline;
            text-decoration-color: color-mix(in srgb, var(--link-color) 60%, transparent);
            text-decoration-thickness: 2px;
        }
        #content ul,
        #content ol {
            padding-left: 1.4rem;
            margin-bottom: 1rem;
        }
        #content blockquote {
            margin: 1rem 0;
            padding: 0.75rem 1rem;
            background: var(--blockquote-bg);
            border-left: 4px solid var(--accent-color);
            border-radius: 6px;
            color: var(--blockquote-color);
        }
        #content hr {
            height: 1px;
            border: none;
            margin: 2rem 0;
            background: var(--border-color);
        }
        #content table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5rem;
            font-size: 0.95rem;
        }
        #content th,
        #content td {
            border: 1px solid var(--border-color);
            padding: 0.5rem 0.75rem;
        }
        #content th {
            background-color: var(--table-header-bg);
            text-align: left;
        }
        #content tr:nth-child(even) td {
            background-color: var(--table-row-alt-bg);
        }
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 1.5rem;
        }
        .table-responsive table {
            margin-bottom: 0;
        }
        #content img {
            max-width: 100%;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            margin: 1rem 0;
        }
        #content > :first-child {
            margin-top: 0;
        }
        article{
            padding: 0 !important;
            padding-left: 0.25rem !important;
            padding-right: 0.25rem !important;
        }
        .light-theme {
            color-scheme: light;
            --bg-color: #ffffff;
            --text-color: #24292f;
            --header-bg: #f6f8fa;
            --nav-bg: #f6f8fa;
            --border-color: #d0d7de;
            --hover-bg: #eaeef2;
            --active-bg: #0969da;
            --active-text: #ffffff;
            --code-bg: #f6f8fa;
            --link-color: #0969da;
            --divider-color: #d8dee4;
            --heading-color: #1f2328;
            --accent-color: #1f6feb;
            --inline-code-bg: #f3f4f6;
            --blockquote-bg: #f8faff;
            --blockquote-color: #424a53;
            --table-header-bg: #eef2fc;
            --table-row-alt-bg: #f9fafb;
        }
        .dark-theme {
            color-scheme: dark;
            --bg-color: #0d1117;
            --text-color: #c9d1d9;
            --header-bg: #161b22;
            --nav-bg: #161b22;
            --border-color: #30363d;
            --hover-bg: #21262d;
            --active-bg: #1f6feb;
            --active-text: #f0f6fc;
            --code-bg: #161b22;
            --link-color: #58a6ff;
            --divider-color: #21262d;
            --heading-color: #f0f6fc;
            --accent-color: #2f81f7;
            --inline-code-bg: #1c2532;
            --blockquote-bg: rgba(56, 139, 253, 0.1);
            --blockquote-color: #9ebdfb;
            --table-header-bg: rgba(56, 139, 253, 0.2);
            --table-row-alt-bg: rgba(255, 255, 255, 0.02);
        }
        @media (max-width: 768px) {
            main {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            nav {
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                grid-column: 1;
                grid-row: 1;
                position: static;
                max-height: none;
            }
            nav ul {
                display: flex;
                overflow-x: auto;
                padding-bottom: 0.5rem;
                gap: 0.5rem;
            }
            nav li {
                margin-bottom: 0;
            }
            nav button {
                white-space: nowrap;
            }
            .divider {
                display: none;
            }
            #content {
                grid-column: 1;
                grid-row: 2;
            }
            #pager {
                grid-column: 1;
                grid-row: 3;
                padding: 0.75rem;
            }
            .table-responsive {
                margin-bottom: 1.25rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>BS Series ✦</h1>
        <div class="header-actions">
            <div class="download-menu">
                <button class="download-toggle" id="downloadToggle" type="button" aria-haspopup="true" aria-expanded="false">Download ▾</button>
                <div class="download-options" id="downloadOptions" role="menu" hidden>
                    <button type="button" data-format="png" role="menuitem">Download PNG</button>
                    <button type="button" data-format="pdf" role="menuitem">Download PDF</button>
                </div>
            </div>
            <button class="theme-toggle" id="themeToggle" type="button">Toggle Theme</button>
        </div>
    </header>
    <main>
        <nav>
            <div class="nav-toolbar">
                <input type="search" id="fileSearch" placeholder="Search notes..." aria-label="Search notes" />
            </div>
            <ul id="fileList"></ul>
        </nav>
        <div aria-hidden="true" class="divider" id="divider"></div>
        <article id="content" aria-live="polite"></article>
        <footer id="pager" aria-label="Section navigation">
            <button id="prevFile" type="button">◀ Previous</button>
            <button id="nextFile" type="button">Next ▶</button>
        </footer>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script>
        const files = [
            "BS_0.md",
            "BS_1.md",
            "BS_2.md",
            "BS_3.md",
            "BS_4.md",
            "BS_5.md",
            "BS_6.md",
            "BS_7.md",
            "BS_8.md",
            "BS_9.md",
            "BS_10.md",
            "BS_11.md",
            "BS_12.md",
            "BS_13.md",
            "BS_14.md",
            "BS_15.md",
            "BS_16.md",
            "BS_17.md",
            "BS_18.md",
            "BS_19.md",
            "BS_20.md"
        ];

        const fileList = document.getElementById("fileList");
        const content = document.getElementById("content");
        const themeToggle = document.getElementById("themeToggle");
        const downloadToggle = document.getElementById("downloadToggle");
        const downloadOptions = document.getElementById("downloadOptions");
        const downloadMenuWrapper = document.querySelector(".download-menu");
        const divider = document.getElementById("divider");
        const searchInput = document.getElementById("fileSearch");
        const prevButton = document.getElementById("prevFile");
        const nextButton = document.getElementById("nextFile");
        const headerEl = document.querySelector("header");
        const highlightThemes = {
            light: document.getElementById("hljsLightTheme"),
            dark: document.getElementById("hljsDarkTheme")
        };
        const downloadOptionButtons = downloadOptions ? Array.from(downloadOptions.querySelectorAll("button[data-format]")) : [];
        const enhanceTables = () => {
            content.querySelectorAll("table").forEach((table) => {
                if (table.parentElement && table.parentElement.classList.contains("table-responsive")) {
                    return;
                }
                const wrapper = document.createElement("div");
                wrapper.className = "table-responsive";
                const parent = table.parentElement;
                if (!parent) {
                    return;
                }
                parent.insertBefore(wrapper, table);
                wrapper.appendChild(table);
            });
        };

        const resetScrollPosition = () => {
            // Ensure new content always starts at the top of the viewport
            content.scrollTop = 0;
            window.scrollTo({ top: 0, behavior: "auto" });
        };

        const THEME_KEY = "bootstrap-notes-theme";
        const SIDEBAR_WIDTH_KEY = "bootstrap-notes-sidebar-width";
        const mediaQuery = window.matchMedia("(max-width: 768px)");

        const clamp = (value, min, max) => Math.min(max, Math.max(min, value));
        const getNumberVar = (name) => {
            const value = Number.parseFloat(getComputedStyle(document.documentElement).getPropertyValue(name));
            return Number.isNaN(value) ? 0 : value;
        };

        const updateHeaderHeight = () => {
            if (!headerEl) {
                return;
            }
            document.documentElement.style.setProperty("--header-height", `${headerEl.offsetHeight}px`);
        };

        const formatLabel = (file) => file.replace(/\.md$/i, "");

        let currentSidebarWidth = getNumberVar("--sidebar-width") || 240;
        let currentFileIndex = 0;
        let isDragging = false;
        let isDownloadMenuOpen = false;

        const getCurrentFilename = () => {
            const fallback = files[0] || "note.md";
            return files[currentFileIndex] || fallback;
        };

        const getCurrentBasename = () => formatLabel(getCurrentFilename());

        const defaultTheme = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";

        const toggleHighlightTheme = (theme) => {
            highlightThemes.light.disabled = theme === "dark";
            highlightThemes.dark.disabled = theme !== "dark";
            if (window.hljs) {
                window.hljs.highlightAll();
            }
        };

        const openDownloadMenu = () => {
            if (!downloadOptions || !downloadToggle) {
                return;
            }
            isDownloadMenuOpen = true;
            downloadOptions.hidden = false;
            downloadOptions.classList.add("is-open");
            downloadToggle.setAttribute("aria-expanded", "true");
            if (downloadOptionButtons.length > 0) {
                downloadOptionButtons[0].focus();
            }
        };

        const closeDownloadMenu = () => {
            if (!downloadOptions || !downloadToggle) {
                return;
            }
            isDownloadMenuOpen = false;
            downloadOptions.classList.remove("is-open");
            downloadOptions.hidden = true;
            downloadToggle.setAttribute("aria-expanded", "false");
        };

        const toggleDownloadMenu = () => {
            if (isDownloadMenuOpen) {
                closeDownloadMenu();
            } else {
                openDownloadMenu();
            }
        };

        const captureContentCanvas = async () => {
            if (typeof window.html2canvas !== "function") {
                throw new Error("Capture library is unavailable.");
            }
            const backgroundColor = getComputedStyle(document.body).getPropertyValue("background-color") || "#ffffff";
            return window.html2canvas(content, {
                backgroundColor: backgroundColor.trim() || undefined,
                scrollY: 0,
                useCORS: true
            });
        };

        const withBusyState = async (button, task) => {
            if (typeof task !== "function") {
                return;
            }
            if (!button) {
                try {
                    await task();
                } catch (error) {
                    console.error(error);
                    alert("Unable to prepare the download. Please try again.");
                }
                return;
            }
            const originalText = button.textContent;
            button.disabled = true;
            button.textContent = "Preparing...";
            button.setAttribute("aria-busy", "true");
            try {
                await task();
            } catch (error) {
                console.error(error);
                alert("Unable to prepare the download. Please try again.");
            } finally {
                button.disabled = false;
                button.textContent = originalText;
                button.removeAttribute("aria-busy");
            }
        };

        const downloadAsPng = async () => {
            const canvas = await captureContentCanvas();
            const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = `${getCurrentBasename()}.png`;
            document.body.appendChild(link);
            link.click();
            link.remove();
        };

        const downloadAsPdf = async () => {
            if (!window.jspdf || typeof window.jspdf.jsPDF !== "function") {
                throw new Error("PDF library is unavailable.");
            }
            const { jsPDF } = window.jspdf;
            const canvas = await captureContentCanvas();
            const imgData = canvas.toDataURL("image/png");
            const pdf = new jsPDF({ orientation: "p", unit: "pt", format: "a4" });
            const pageWidth = pdf.internal.pageSize.getWidth();
            const pageHeight = pdf.internal.pageSize.getHeight();
            const imgWidth = pageWidth;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft > 0) {
                position -= pageHeight;
                pdf.addPage();
                pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            pdf.save(`${getCurrentBasename()}.pdf`);
        };

        const applyTheme = (theme) => {
            document.body.classList.toggle("dark-theme", theme === "dark");
            document.body.classList.toggle("light-theme", theme === "light");
            themeToggle.textContent = theme === "dark" ? "Switch to Light" : "Switch to Dark";
            toggleHighlightTheme(theme);
        };

        const loadTheme = () => {
            const stored = localStorage.getItem(THEME_KEY);
            const theme = stored === "dark" || stored === "light" ? stored : defaultTheme;
            applyTheme(theme);
        };

        const toggleTheme = () => {
            const nextTheme = document.body.classList.contains("dark-theme") ? "light" : "dark";
            localStorage.setItem(THEME_KEY, nextTheme);
            applyTheme(nextTheme);
            updateHeaderHeight();
        };

        const setActiveButton = (filename) => {
            Array.from(fileList.querySelectorAll("button")).forEach((btn) => {
                btn.classList.toggle("active", btn.dataset.file === filename);
            });
        };

        const updatePager = () => {
            const prevIndex = currentFileIndex - 1;
            const nextIndex = currentFileIndex + 1;

            if (prevIndex >= 0) {
                prevButton.disabled = false;
                prevButton.dataset.target = files[prevIndex];
                prevButton.textContent = `◀ ${formatLabel(files[prevIndex])}`;
            } else {
                prevButton.disabled = true;
                prevButton.dataset.target = "";
                prevButton.textContent = "◀ Start";
            }

            if (nextIndex < files.length) {
                nextButton.disabled = false;
                nextButton.dataset.target = files[nextIndex];
                nextButton.textContent = `${formatLabel(files[nextIndex])} ▶`;
            } else {
                nextButton.disabled = true;
                nextButton.dataset.target = "";
                nextButton.textContent = "End ▶";
            }
        };

        const filterNavigation = (term) => {
            const query = term.trim().toLowerCase();
            Array.from(fileList.children).forEach((item) => {
                const value = item.dataset.filterValue || "";
                item.style.display = !query || value.includes(query) ? "" : "none";
            });
        };

        const runHighlighting = () => {
            if (!window.hljs) {
                return;
            }
            content.querySelectorAll("pre code").forEach((block) => window.hljs.highlightElement(block));
        };

        const renderMarkdown = async (filename) => {
            const index = files.indexOf(filename);
            if (index !== -1) {
                currentFileIndex = index;
                updatePager();
            }
            try {
                const response = await fetch(filename);
                if (!response.ok) {
                    throw new Error(`Failed to load ${filename}`);
                }
                const text = await response.text();
                content.innerHTML = marked.parse(text);
                enhanceTables();
                setActiveButton(filename);
                runHighlighting();
                requestAnimationFrame(resetScrollPosition);
            } catch (error) {
                content.innerHTML = `<p>Unable to load <code>${filename}</code>.</p>`;
            }
        };

        const buildNav = () => {
            files.forEach((file, index) => {
                const item = document.createElement("li");
                const button = document.createElement("button");
                button.type = "button";
                button.dataset.file = file;
                const label = formatLabel(file);
                button.textContent = label;
                button.addEventListener("click", () => renderMarkdown(file));
                if (index === 0) {
                    button.classList.add("active");
                }
                item.dataset.filterValue = label.toLowerCase();
                item.appendChild(button);
                fileList.appendChild(item);
            });
        };

        const applySidebarWidth = (width) => {
            currentSidebarWidth = width;
            document.documentElement.style.setProperty("--sidebar-width", `${width}px`);
        };

        const loadSidebarWidth = () => {
            const stored = localStorage.getItem(SIDEBAR_WIDTH_KEY);
            if (!stored) {
                return;
            }
            const min = getNumberVar("--sidebar-min-width");
            const max = getNumberVar("--sidebar-max-width");
            const width = clamp(Number.parseFloat(stored), min, max);
            if (!Number.isNaN(width)) {
                applySidebarWidth(width);
            }
        };

        const stopDragging = () => {
            if (!isDragging) {
                return;
            }
            isDragging = false;
            document.body.classList.remove("resizing");
            divider.classList.remove("dragging");
            localStorage.setItem(SIDEBAR_WIDTH_KEY, String(currentSidebarWidth));
        };

        const handlePointerMove = (event) => {
            if (!isDragging) {
                return;
            }
            const min = getNumberVar("--sidebar-min-width");
            const max = getNumberVar("--sidebar-max-width");
            const width = clamp(event.clientX, min, max);
            applySidebarWidth(width);
        };

        const setupResize = () => {
            divider.addEventListener("pointerdown", (event) => {
                if (mediaQuery.matches) {
                    return;
                }
                isDragging = true;
                divider.classList.add("dragging");
                document.body.classList.add("resizing");
                divider.setPointerCapture(event.pointerId);
                event.preventDefault();
            });

            divider.addEventListener("pointermove", (event) => {
                if (!divider.hasPointerCapture(event.pointerId)) {
                    return;
                }
                handlePointerMove(event);
            });

            divider.addEventListener("pointerup", (event) => {
                if (divider.hasPointerCapture(event.pointerId)) {
                    divider.releasePointerCapture(event.pointerId);
                }
                stopDragging();
            });

            divider.addEventListener("lostpointercapture", stopDragging);
            document.addEventListener("pointermove", handlePointerMove);
            document.addEventListener("pointerup", stopDragging);
            window.addEventListener("blur", stopDragging);

            const handleMediaChange = (event) => {
                if (event.matches) {
                    stopDragging();
                }
            };
            if (typeof mediaQuery.addEventListener === "function") {
                mediaQuery.addEventListener("change", handleMediaChange);
            } else if (typeof mediaQuery.addListener === "function") {
                mediaQuery.addListener(handleMediaChange);
            }
        };

        if (downloadToggle && downloadOptions) {
            downloadToggle.addEventListener("click", (event) => {
                event.stopPropagation();
                toggleDownloadMenu();
            });
        }

        downloadOptionButtons.forEach((button) => {
            button.addEventListener("click", (event) => {
                event.stopPropagation();
                const format = button.dataset.format;
                const action = format === "pdf" ? downloadAsPdf : downloadAsPng;
                const promise = withBusyState(button, action);
                if (promise && typeof promise.finally === "function") {
                    promise.finally(() => {
                        closeDownloadMenu();
                        downloadToggle?.focus();
                    });
                } else {
                    closeDownloadMenu();
                    if (downloadToggle) {
                        downloadToggle.focus();
                    }
                }
            });
        });

        document.addEventListener("click", (event) => {
            if (!isDownloadMenuOpen) {
                return;
            }
            if (downloadMenuWrapper && downloadMenuWrapper.contains(event.target)) {
                return;
            }
            closeDownloadMenu();
        });

        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape" && isDownloadMenuOpen) {
                closeDownloadMenu();
                downloadToggle?.focus();
            }
        });
        themeToggle.addEventListener("click", toggleTheme);
        prevButton.addEventListener("click", () => {
            const target = prevButton.dataset.target;
            if (target) {
                renderMarkdown(target);
            }
        });
        nextButton.addEventListener("click", () => {
            const target = nextButton.dataset.target;
            if (target) {
                renderMarkdown(target);
            }
        });
        if (searchInput) {
            searchInput.addEventListener("input", (event) => {
                filterNavigation(event.target.value);
            });
        }

        buildNav();
        loadTheme();
        loadSidebarWidth();
        setupResize();
        updateHeaderHeight();
        window.addEventListener("resize", updateHeaderHeight);
        renderMarkdown(files[0]);
    </script>
</body>
</html>
